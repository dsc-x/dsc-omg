import { Component } from "preact";
import style from "./style";

import axios from "axios";
import Snackbar from "preact-material-components/Snackbar";
import "preact-material-components/Snackbar/style.css";

export default class Footer extends Component {
  constructor(props) {
    super(props);
    if (typeof window !== "undefined") {
      this.io = new IntersectionObserver(
        (entries) => {
          const visibleEntries = entries.filter((e) => e.isIntersecting);

          visibleEntries
            .filter((e) => e.target instanceof HTMLImageElement)
            .forEach((e) => {
              e.target.src = e.target.dataset.src;
            });
        },
        {
          /* Using default options. Details below */
        }
      );
    }
    this.getFooter = this.getFooter.bind(this);
  }

  showRefreshSnack = () => {
    this.snackbar.MDComponent.show({
      message: "Site updated. Refresh this page for better experience.",
      actionText: "Refresh",
      timeout: 5000,
      actionHandler: () => {
        window.location.reload();
      },
    });
  };

  getFooter() {
    axios
      .post("https://badges.dscomg.com/api/session/", {
        session: "footer",
        email: this.props.user.email,
      })
      .then(
        (response) => {
          if (response.data.badgeEarned) {
            this.snackbar.MDComponent.show({
              message: "You earned a badge!",
              timeout: 5000,
            });
          } else {
            this.snackbar.MDComponent.show({
              message: "You already have this badge",
              timeout: 5000,
            });
          }
        },
        (error) => {
          console.log(error);
        }
      );
  }

  componentDidMount() {
    const ele = document.querySelector(`.footer_logo`);
    window.addEventListener("showRefreshSnack", this.showRefreshSnack);

    if (!this.io || !ele) return;

    this.io.observe(ele);
  }

  componentWillUnmount() {
    if (!this.io) return;
    this.io.disconnect();
    window.removeEventListener("showRefreshSnack", this.showRefreshSnack);
  }

  render({ rootPath }) {
    return (
      <div class={style.footer}>
        <div class={style.footer_logo}>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="337"
            height="88"
            viewBox="0 0 3537 258"
          >
            <g fill="none" fillRule="evenodd" stroke="none" strokeWidth="1">
              <g transform="translate(-175 -201) translate(175 201)">
                <g transform="translate(2849.64)">
                  <g fill="#4185F3" transform="translate(486.606 .314)">
                    <path
                      d="M6.97423671 122.036951L25.4402153 196.592765 68.3130762 225.215978 123.025461 225.215978 173.556851 211.102569 193.613645 165.066032 193.613645 122.036951z"
                      opacity="0.229"
                    ></path>
                    <path
                      fillRule="nonzero"
                      d="M102.364 235.186c66.568 0 97.34-45.53 97.34-105.504 0-2.512 0-7.85-.628-13.502H124.03v16.642h56.206c-1.256 51.182-24.178 84.78-77.558 84.78-55.578-.314-83.838-41.448-83.21-100.166.314-59.032 27.632-99.852 83.21-99.852 34.54 0 58.404 18.212 69.08 46.158l17.898-5.652C177.724 23.236 147.894 0 102.364 0 36.11 0 0 47.414 0 117.436c0 70.336 36.424 117.75 102.364 117.75z"
                    ></path>
                  </g>
                  <g fill="#049C59">
                    <path
                      d="M6.58 122.350951L25.0459786 196.906765 67.9188395 225.529978 122.631224 225.529978 173.162615 211.416569 193.219408 165.380032 193.219408 122.350951z"
                      opacity="0.229"
                    ></path>
                    <path
                      fillRule="nonzero"
                      d="M102.678 235.5c67.824 0 102.992-48.356 102.992-117.75S170.502 0 102.678 0C35.168 0 0 48.356 0 117.75S35.168 235.5 102.678 235.5zm0-17.584c-55.578-.314-83.838-41.448-83.21-100.166.314-59.032 27.632-100.166 83.21-100.166 55.578.314 83.524 41.134 83.524 100.166 0 58.718-27.946 100.166-83.524 100.166z"
                    ></path>
                  </g>
                  <g transform="translate(240.56 4.71)">
                    <path
                      fill="#FFBD00"
                      d="M12.7816312 117.640951L12.7816312 37.1393898 37.4389844 67.9894745 105.823521 206.728754 204.211569 26.5370346 211.942608 117.640951 151.353987 117.640951 105.823521 220.819978 59.1270852 117.640951z"
                      opacity="0.294"
                    ></path>
                    <path
                      fill="#FABB07"
                      fillRule="nonzero"
                      d="M17.584 226.08L17.584 41.448 101.736 226.08 116.808 226.08 200.96 41.448 200.96 225.766 218.544 225.766 218.544 0 201.274 0 109.272 200.018 16.956 0 0 0 0 226.08z"
                    ></path>
                  </g>
                </g>
                <path
                  fill="#666C73"
                  fillRule="nonzero"
                  d="M56.82 202c28.366 0 51.155-8.53 68.365-25.588C142.395 159.353 151 136.882 151 109c0-27.71-8.605-50.137-25.815-67.282C107.975 24.573 85.186 16 56.82 16H0v186h56.82zm.213-23H24V39h33.033c21.675 0 38.755 6.222 51.24 18.667C120.758 70.11 127 87.222 127 109c0 21.95-6.242 39.105-18.727 51.463C95.788 172.821 78.708 179 57.033 179zm170.55 27c12.848 0 24.35-3.017 34.506-9.052 10.156-6.034 18.099-14.396 23.828-25.086l-21.354-10.345c-8.681 15.173-20.66 22.759-35.938 22.759-11.111 0-20.66-3.793-28.646-11.38-7.986-7.586-12.153-17.586-12.5-30h100.26l.261-2.586c0-21.896-5.599-38.922-16.797-51.077C260.005 77.078 244.944 71 226.021 71c-18.403 0-33.507 6.422-45.313 19.267C168.903 103.112 163 119.19 163 138.5c0 19.483 6.076 35.603 18.23 48.362C193.381 199.621 208.832 206 227.582 206zM263 123h-73c2.078-9.458 6.365-16.989 12.86-22.593C209.353 94.802 217.103 92 226.11 92c10.911 0 19.614 2.934 26.109 8.8 6.495 5.868 10.088 13.268 10.781 22.2zm105.163 79L420 75h-25.4l-37.84 98.49h-.52L318.919 75H293l51.318 127h23.845zm119.42 4c12.848 0 24.35-3.017 34.506-9.052 10.156-6.034 18.098-14.396 23.828-25.086l-21.355-10.345c-8.68 15.173-20.66 22.759-35.937 22.759-11.111 0-20.66-3.793-28.646-11.38-7.986-7.586-12.153-17.586-12.5-30h100.26l.261-2.586c0-21.896-5.599-38.922-16.797-51.077C520.005 77.078 504.944 71 486.021 71c-18.403 0-33.507 6.422-45.313 19.267C428.903 103.112 423 119.19 423 138.5c0 19.483 6.076 35.603 18.23 48.362C453.381 199.621 468.832 206 487.582 206zM523 123h-73c2.078-9.458 6.365-16.989 12.86-22.593C469.353 94.802 477.103 92 486.11 92c10.911 0 19.614 2.934 26.109 8.8 6.495 5.868 10.088 13.268 10.781 22.2zm70 79V16h-24v186h24zm84.5 4c18.888 0 34.483-6.38 46.786-19.138C736.762 174.276 743 158.155 743 138.5c0-19.483-6.238-35.603-18.714-48.362C711.983 77.379 696.388 71 677.5 71s-34.57 6.38-47.046 19.138C618.151 102.897 612 119.018 612 138.5c0 19.483 6.151 35.603 18.454 48.362C642.931 199.621 658.612 206 677.5 206zm0-22c-11.758 0-21.615-4.245-29.569-12.734C639.977 162.776 636 151.687 636 138c0-13.514 3.977-24.516 11.931-33.006C656.058 96.331 665.915 92 677.5 92c11.585 0 21.442 4.331 29.569 12.994C715.023 113.484 719 124.486 719 138c0 13.687-3.977 24.776-11.931 33.266-7.954 8.49-17.81 12.734-29.569 12.734zm108.435 74v-55.945l-1.04-17.612h1.04c4.163 6.562 10.103 11.828 17.821 15.8 7.718 3.97 16.26 5.956 25.626 5.956 16.824 0 31.046-6.561 42.667-19.684C884.016 173.392 890 157.421 890 138.6c0-18.648-5.984-34.62-17.951-47.916C860.429 77.561 846.206 71 829.382 71c-9.366 0-17.908 1.986-25.626 5.957s-13.658 9.238-17.821 15.8h-1.04V75.143H762V258h23.935zm39.565-74c-11.596 0-21.288-4.245-29.077-12.734C788.808 162.603 785 151.514 785 138c0-13.34 3.808-24.343 11.423-33.006C804.212 96.331 813.903 92 825.5 92c11.423 0 21.029 4.331 28.817 12.994C862.106 113.657 866 124.66 866 138c0 13.514-3.894 24.516-11.683 33.006C846.53 179.669 836.923 184 825.5 184zm142.083 22c12.848 0 24.35-3.017 34.506-9.052 10.156-6.034 18.098-14.396 23.828-25.086l-21.354-10.345c-8.681 15.173-20.66 22.759-35.938 22.759-11.111 0-20.66-3.793-28.646-11.38-7.986-7.586-12.153-17.586-12.5-30h100.26l.261-2.586c0-21.896-5.599-38.922-16.797-51.077C1000.005 77.078 984.944 71 966.021 71c-18.403 0-33.507 6.422-45.313 19.267C908.903 103.112 903 119.19 903 138.5c0 19.483 6.076 35.603 18.23 48.362C933.381 199.621 948.832 206 967.582 206zM1002 123h-73c2.078-9.458 6.365-16.989 12.86-22.593C948.353 94.802 956.103 92 965.11 92c10.911 0 19.614 2.934 26.109 8.8 6.495 5.868 10.088 13.268 10.781 22.2zm70.987 79v-70.179c0-9.703 3.346-18.194 10.038-25.472 6.692-7.278 14.557-10.916 23.595-10.916 6.432 0 11.125.606 14.08 1.819l7.3-23.133c-4.867-2.08-10.777-3.119-17.73-3.119-7.3 0-14.73 2.383-22.291 7.148-7.562 4.765-12.559 10.527-14.992 17.285h-1.043V74.639H1049V202h23.987zm174.068 4c17.279 0 31.966-4.841 44.061-14.524 11.923-9.856 17.884-22.91 17.884-39.163 0-13.487-4.017-24.855-12.052-34.106-8.035-9.25-21.47-17.074-40.303-23.472-18.489-6.397-30.497-11.93-36.027-16.599-5.01-4.668-7.516-10.201-7.516-16.599 0-7.78 3.197-14.091 9.59-18.933 6.393-5.187 14.255-7.78 23.586-7.78 8.812 0 16.285 2.29 22.419 6.873 6.134 4.582 10.238 10.33 12.311 17.247l22.29-9.337c-3.456-10.72-10.367-19.625-20.735-26.714C1272.196 15.631 1259.928 12 1245.76 12c-16.07 0-29.633 4.841-40.692 14.524-10.885 9.683-16.328 21.354-16.328 35.013 0 19.539 9.849 34.322 29.547 44.35 3.628 1.903 12.872 5.534 27.732 10.894 14.687 5.014 24.71 10.201 30.066 15.561 5.702 5.533 8.553 12.19 8.553 19.97 0 9.338-3.456 16.816-10.368 22.435-6.911 5.62-15.81 8.43-26.696 8.43-5.01 0-9.762-.908-14.255-2.724a44.048 44.048 0 01-12.31-7.521c-3.716-3.199-6.956-7.046-9.72-11.542-2.765-4.495-4.925-9.51-6.48-15.042L1182 155.684c4.493 15.562 12.614 27.838 24.363 36.83 11.75 8.99 25.314 13.486 40.692 13.486zm130.268-2c8.258 0 15.483-1.123 21.677-3.37l-7.484-21.26a28.687 28.687 0 01-5.032 1.686 23.767 23.767 0 01-5.549.648c-4.129 0-7.827-1.513-11.096-4.537-3.27-3.025-4.904-8.772-4.904-17.241v-63.26h30.968V74.89h-30.968V36h-23.741v38.889H1319v21.778h22.194v71.037c.172 11.407 3.655 20.308 10.451 26.703 6.796 6.395 15.355 9.593 25.678 9.593zm88.366 2c8.158 0 16.013-2.071 23.563-6.213 7.551-4.143 13.149-9.32 16.794-15.534h1.042v17.605H1530V75h-23.954v70.16c0 10.701-3.211 19.892-9.634 27.572-6.422 7.68-14.407 11.521-23.953 11.521-20.483 0-30.984-10.356-31.505-31.067V75H1417v79.74c0 16.396 4.21 29.038 12.628 37.927S1450.067 206 1465.688 206zm143.929 0c9.366 0 17.908-1.99 25.626-5.97 7.718-3.98 13.658-9.258 17.821-15.833h1.04v17.65H1677V16h-23.935v58.661l1.04 17.65h-1.04c-4.163-6.575-10.103-11.853-17.821-15.833-7.718-3.98-16.26-5.97-25.626-5.97-16.65 0-30.96 6.576-42.927 19.727-11.794 13.324-17.691 29.33-17.691 48.02 0 18.688 5.897 34.694 17.691 48.018 11.968 13.151 26.276 19.727 42.927 19.727zm3.882-22c-11.423 0-21.029-4.331-28.817-12.994-7.789-8.49-11.683-19.492-11.683-33.006 0-13.34 3.894-24.343 11.683-33.006C1592.47 96.331 1602.077 92 1613.5 92c11.596 0 21.202 4.331 28.817 12.994C1650.106 113.657 1654 124.66 1654 138c0 13.687-3.894 24.776-11.683 33.266-7.442 8.49-17.048 12.734-28.817 12.734zm147.083 22c12.848 0 24.35-3.017 34.506-9.052 10.156-6.034 18.099-14.396 23.828-25.086l-21.354-10.345c-8.681 15.173-20.66 22.759-35.938 22.759-11.111 0-20.66-3.793-28.646-11.38-7.986-7.586-12.153-17.586-12.5-30h100.26l.261-2.586c0-21.896-5.599-38.922-16.797-51.077C1793.005 77.078 1777.944 71 1759.021 71c-18.403 0-33.507 6.422-45.313 19.267C1701.903 103.112 1696 119.19 1696 138.5c0 19.483 6.076 35.603 18.23 48.362 12.152 12.759 27.603 19.138 46.353 19.138zM1795 123h-73c2.078-9.458 6.365-16.989 12.86-22.593 6.494-5.605 14.244-8.407 23.25-8.407 10.911 0 19.614 2.934 26.109 8.8 6.495 5.868 10.088 13.268 10.781 22.2zm70.954 79v-70.16c0-10.701 3.211-19.892 9.634-27.572 6.422-7.68 14.407-11.521 23.953-11.521 20.483 0 30.984 10.356 31.505 31.067V202H1955v-79.74c0-16.396-4.21-29.038-12.628-37.927S1921.933 71 1906.312 71c-8.16 0-16.014 2.071-23.564 6.213-7.551 4.143-13.149 9.32-16.794 15.534h-1.042V75.142H1842V202h23.954zm159.369 2c8.258 0 15.483-1.123 21.677-3.37l-7.484-21.26a28.687 28.687 0 01-5.032 1.686 23.767 23.767 0 01-5.549.648c-4.129 0-7.827-1.513-11.096-4.537-3.27-3.025-4.904-8.772-4.904-17.241v-63.26h30.968V74.89h-30.968V36h-23.741v38.889H1967v21.778h22.194v71.037c.172 11.407 3.655 20.308 10.451 26.703 6.796 6.395 15.355 9.593 25.678 9.593zm183.08 2c14.684 0 28.42-2.896 41.204-8.689 12.784-5.792 23.582-13.962 32.393-24.509l-17.363-16.858c-15.894 18.155-34.639 27.232-56.235 27.232-20.559 0-37.749-6.916-51.57-20.748-13.648-13.66-20.472-31.469-20.472-53.428 0-21.959 6.824-39.768 20.472-53.428 13.821-13.832 31.012-20.748 51.57-20.748 20.732 0 37.75 8.04 51.052 24.12l17.104-16.6C2259.108 22.116 2236.39 12 2208.402 12c-27.642 0-50.62 9.337-68.932 28.01C2121.157 58.34 2112 81.336 2112 109c0 27.665 9.157 50.748 27.47 69.249 18.485 18.5 41.463 27.751 68.932 27.751zM2327 202V16h-24v186h24zm75.689 4c8.158 0 16.013-2.071 23.563-6.213 7.551-4.143 13.149-9.32 16.794-15.534h1.042v17.605H2467V75h-23.954v70.16c0 10.701-3.211 19.892-9.634 27.572-6.422 7.68-14.407 11.521-23.953 11.521-20.483 0-30.984-10.356-31.505-31.067V75H2354v79.74c0 16.396 4.21 29.038 12.628 37.927S2387.067 206 2402.688 206zm159.693 0c16.824 0 31.046-6.576 42.667-19.727 11.967-13.151 17.951-29.157 17.951-48.019 0-18.688-5.984-34.695-17.951-48.019-11.62-13.151-25.843-19.727-42.667-19.727-9.366 0-17.908 1.99-25.626 5.97-7.718 3.98-13.658 9.258-17.821 15.833h-1.04l1.04-17.65V16H2495v185.847h22.894v-17.65h1.041c4.163 6.575 10.103 11.853 17.821 15.833 7.718 3.98 16.26 5.97 25.626 5.97zm-3.882-22c-11.596 0-21.288-4.245-29.077-12.734C2521.808 162.603 2518 151.514 2518 138c0-13.34 3.808-24.343 11.423-33.006C2537.212 96.331 2546.903 92 2558.5 92c11.423 0 21.029 4.331 28.817 12.994C2595.106 113.657 2599 124.66 2599 138c0 13.514-3.894 24.516-11.683 33.006-7.788 8.663-17.394 12.994-28.817 12.994zm130.193 22c14.758 0 27-3.793 36.722-11.38 9.723-7.586 14.585-16.896 14.585-27.93 0-19.138-12.675-31.81-38.025-38.018l-19.272-4.913c-13.717-3.104-20.575-8.276-20.575-15.518 0-4.482 2.474-8.275 7.422-11.379 4.949-3.103 10.548-4.655 16.799-4.655 6.771 0 12.892 1.509 18.361 4.526 5.47 3.017 9.42 7.198 11.85 12.543l21.356-8.793c-3.646-8.966-10.027-16.12-19.142-21.466-9.116-5.345-19.316-8.017-30.602-8.017-14.758 0-26.869 3.491-36.332 10.474-9.462 6.983-14.194 16.25-14.194 27.802 0 17.586 12.415 29.483 37.243 35.69l21.878 5.43c12.5 3.794 18.751 9.742 18.751 17.845 0 4.483-2.56 8.362-7.683 11.638-5.122 3.276-11.502 4.914-19.142 4.914-7.119 0-13.673-2.112-19.664-6.336-5.99-4.224-10.547-10.13-13.673-17.716L2634 169.793c4.167 10.862 11.112 19.612 20.835 26.25 9.724 6.638 21.01 9.957 33.858 9.957z"
                ></path>
              </g>
            </g>
          </svg>
        </div>
        <div class={style.footer_links}>
          <div class={style.footer_link}>
            <a href="https://twitter.com/omgdsc">DSCOMG 2020</a>
            <a href="https://dscomg.com/schedule">Schedule</a>
            <a href="https://dscomg.com/speakers">Speakers</a>
            <a href="https://dscomg.com/faq">FAQ</a>
            <p
              style={{ cursor: "pointer", fontSize: "80%" }}
              onClick={this.getFooter}
            >
              Hmmmmmmm?
            </p>
          </div>
        </div>
        <Snackbar
          ref={(snackbar) => {
            this.snackbar = snackbar;
          }}
        />
      </div>
    );
  }
}
